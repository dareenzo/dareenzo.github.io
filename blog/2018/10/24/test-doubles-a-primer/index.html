<!DOCTYPE html><html class="no-js"><head prefix="og: http://ogp.me/ns# fb: http://ogp.me/ns/fb# object: http://ogp.me/ns/object# article: http://ogp.me/ns/article# profile: http://ogp.me/ns/profile#"><meta charset="utf-8" /><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta http-equiv="x-dns-prefetch-control" content="on"/><link rel="dns-prefetch" href="https://cdnjs.cloudflare.com"><link rel="dns-prefetch" href="https://www.googletagmanager.com"><link rel="dns-prefetch" href="https://www.google-analytics.com"><link rel="preconnect" href="https://cdnjs.cloudflare.com" crossorigin="anonymous"><link rel="preconnect" href="https://www.googletagmanager.com" crossorigin="anonymous"><link rel="preconnect" href="https://www.google-analytics.com" crossorigin="anonymous"><link rel="prerender" href="/blog/2018/11/08/splitting-and-naming-test-cases-better/" /><link rel="prerender" href="/blog/2018/05/04/mysql-subtleties/" /><title>Test Doubles: A Primer &middot; Paulo Phagula</title><meta name="description" content=""><link rel="canonical" href="https://dareenzo.github.io/blog/2018/10/24/test-doubles-a-primer/"><link rel="prev" href="/blog/2018/05/04/mysql-subtleties/" title="A few MySQL subtleties and how to go about them" /><link rel="next" href="/blog/2018/11/08/splitting-and-naming-test-cases-better/" title="Splitting and Naming Test Cases Better" /><meta name="HandheldFriendly" content="True" /><meta name="MobileOptimized" content="320" /><meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no" /><meta name="format-detection" content="telephone=no" /><meta http-equiv="x-rim-auto-match" content="none" /><meta http-equiv="cleartype" content="on"><meta name="mobile-web-app-capable" content="yes"><link rel="icon" sizes="192x192" href="/assets/images/favicons/android-chrome-192x192.png"><link rel="manifest" href="/manifest.json"><meta name="theme-color" content="#333"><link rel="mask-icon" href="/assets/images/favicons/safari-pinned-tab.svg" color="#333"><meta name="apple-mobile-web-app-capable" content="yes"><meta name="apple-mobile-web-app-title" content="Paulo Phagula"><meta name="apple-mobile-web-app-status-bar-style" content="black-translucent"><link rel="apple-touch-icon" sizes="180x180" href="/assets/images/favicons/apple-touch-icon.png"><meta name="generator" content="jekyll"><meta name="revisit-after" content="1 DAYS"><meta name="author" content="Paulo Phagula" /><link rel="publisher" href="https://plus.google.com/+PauloPhagula" /><link rel="author" href="/about"><meta name="contact" content="paulo.phagula@gmail.com" /><meta name="geography" content="Mozambique"><meta name="source" content="https://github.com/dareenzo/dareenzo.github.io"> <!-- twitter meta --><meta name="twitter:card" content="summary_large_image" /><meta name="twitter:site" content="@dareenzo" /><meta name="twitter:creator" content="@dareenzo"><meta name="twitter:url" content="https://dareenzo.github.io/blog/2018/10/24/test-doubles-a-primer/" /> <!-- opengraph --><meta property="og:type" content="website" /><meta property="og:url" content="https://dareenzo.github.io/blog/2018/10/24/test-doubles-a-primer/" /><meta property="og:site_name" content="Paulo Phagula" /> <!-- SEO Property Combo --><meta property="og:title" name="twitter:title" itemprop="title name" content="Test Doubles: A Primer &middot; Paulo Phagula" /><meta property="og:description" name="twitter:description" itemprop="description" content="" /><meta property="og:image" name="twitter:image" itemprop="image primaryImageOfPage" content="https://dareenzo.github.io/content/2018/10/testing-mock-objects.png" /><link rel="alternate" type="application/atom+xml" title="Paulo Phagula &raquo; Atom Feed" href="https://dareenzo.github.io/feed.atom.xml"><link rel="alternate" type="application/rss+xml" title="Paulo Phagula &raquo; RSS Feed" href="https://dareenzo.github.io/feed.rss.xml"><meta name="google-site-verification" content="hXGNVG1mBEAHY0UFP_2RAzcWhzVKmQmWLbAtqPAafog" /><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/themes/prism.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/plugins/toolbar/prism-toolbar.min.css"><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.4.0/css/font-awesome.min.css"><style type="text/css"> /*! normalize.css v8.0.0 | MIT License | github.com/necolas/normalize.css */html{line-height:1.15;-webkit-text-size-adjust:100%}body{margin:0}h1{font-size:2em;margin:0.67em 0}hr{box-sizing:content-box;height:0;overflow:visible}pre{font-family:monospace, monospace;font-size:1em}a{background-color:transparent}abbr[title]{border-bottom:none;text-decoration:underline;text-decoration:underline dotted}b,strong{font-weight:bolder}code,kbd,samp{font-family:monospace, monospace;font-size:1em}small{font-size:80%}sub,sup{font-size:75%;line-height:0;position:relative;vertical-align:baseline}sub{bottom:-0.25em}sup{top:-0.5em}img{border-style:none}button,input,optgroup,select,textarea{font-family:inherit;font-size:100%;line-height:1.15;margin:0}button,input{overflow:visible}button,select{text-transform:none}button,[type="button"],[type="reset"],[type="submit"]{-webkit-appearance:button}button::-moz-focus-inner,[type="button"]::-moz-focus-inner,[type="reset"]::-moz-focus-inner,[type="submit"]::-moz-focus-inner{border-style:none;padding:0}button:-moz-focusring,[type="button"]:-moz-focusring,[type="reset"]:-moz-focusring,[type="submit"]:-moz-focusring{outline:1px dotted ButtonText}fieldset{padding:0.35em 0.75em 0.625em}legend{box-sizing:border-box;color:inherit;display:table;max-width:100%;padding:0;white-space:normal}progress{vertical-align:baseline}textarea{overflow:auto}[type="checkbox"],[type="radio"]{box-sizing:border-box;padding:0}[type="number"]::-webkit-inner-spin-button,[type="number"]::-webkit-outer-spin-button{height:auto}[type="search"]{-webkit-appearance:textfield;outline-offset:-2px}[type="search"]::-webkit-search-decoration{-webkit-appearance:none}::-webkit-file-upload-button{-webkit-appearance:button;font:inherit}details{display:block}summary{display:list-item}template{display:none}[hidden]{display:none}.hidden{display:none !important}.visuallyhidden{border:0;clip:rect(0 0 0 0);height:1px;margin:-1px;overflow:hidden;padding:0;position:absolute;width:1px;white-space:nowrap}.visuallyhidden.focusable:active,.visuallyhidden.focusable:focus{clip:auto;height:auto;margin:0;overflow:visible;position:static;width:auto;white-space:inherit}.invisible{visibility:hidden}.clearfix:before,.clearfix:after{content:" ";display:table}.clearfix:after{clear:both}.no-list{list-style:none;margin:0;padding:0}.no-list>li{margin:0;padding:0}.text-right{text-align:right}.text-left{text-align:left}.text-center{text-align:center}.text-justify{text-align:justify}.text-uppercase{text-transform:uppercase}.text-lowercase{text-transform:lowercase}.left,.float-left{float:left}.right,.float-right{float:right}.pull-right{float:right !important}.pull-left{float:left !important}*{box-sizing:border-box}html{color:#222;font-size:1em;line-height:1.4}body{color:#44484a;text-rendering:optimizeLegibility;font-size:18px;font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Helvetica,Arial,sans-serif,"Apple Color Emoji","Android Emoji","Segoe UI Emoji","Segoe UI Symbol";line-height:1.5;height:100%;margin:0 auto;overflow-y:scroll;visibility:visible;word-break:break-word;word-wrap:break-word}body,input,button{-webkit-font-smoothing:antialiased;-moz-osx-font-smoothing:grayscale}h1,h2,h3,h4,h5,h6{margin:20px 0 14px 0;color:#262626;font-weight:600;line-height:1.25}h1{font-size:2em}h2{font-size:1.5em}h3{font-size:1.17em}h4{font-size:1em}h5{font-size:0.83em}h6{font-size:0.75em}p{line-height:1.5;margin:15px 0}hr{display:block;height:1px;border:0;border-top:1px solid #ddd;margin:1em 0;padding:0;overflow:hidden;background:transparent}audio,canvas,iframe,img,svg,video{vertical-align:middle}del{text-decoration:line-through;color:#999}ins{color:#000}img{max-width:100%}img.emoji{width:20px !important;margin:0px !important;float:none !important;border:none !important}.img--circle{border-radius:50%}::selection{background:#b3d4fc;text-shadow:none}::-moz-selection{background:#b3d4fc;text-shadow:none}a:link,a:visited{text-decoration:none;color:#4492ff}a:hover{text-decoration:underline}b,strong{font-weight:bold}em{font-style:italic}pre{padding:16px;overflow:auto;line-height:1.45;background-color:#f6f8fa;border-radius:3px;word-wrap:normal;margin-top:0;margin-bottom:16px}code{font-family:Menlo,Monaco,Consolas,"Liberation Mono","Roboto Mono","Courier New",Courier,monospace !important;font-size:0.9em;padding:0.2em 0.4em;margin:0;background-color:rgba(27,31,35,0.05);border-radius:3px}pre code{display:inline;max-width:auto;padding:0;margin:0;overflow:visible;line-height:inherit;word-wrap:normal;background-color:transparent;border:0}pre>code{padding:0;margin:0;word-break:normal;white-space:pre;background:transparent;border:0}blockquote{font-style:italic;border-left:2px solid #4492ff;padding-left:15px;margin-left:0}ul,ol{padding:0;margin:0 0 10px 10px;padding-left:5px;list-style-position:outside;display:block}ul li ul,ul li ol{padding:0;margin:0 0 0px 10px;padding-left:5px;list-style-position:outside;display:block;font-size:inherit}ul{list-style-type:disc}ol{list-style-type:decimal}table{border-spacing:0;border-collapse:collapse}td,th{padding:0}table{margin-top:0;margin-bottom:16px;display:block;width:100%;overflow:auto}table tr{background-color:#fff;border-top:1px solid #c6cbd1}table th{font-weight:600}table th,table td{padding:6px 13px;border:1px solid #dfe2e5}fieldset{border:0;margin:0;padding:0}textarea{resize:vertical}input[type="text"],input[type="password"],input[type="date"],input[type="datetime"],input[type="datetime-local"],input[type="month"],input[type="week"],input[type="email"],input[type="number"],input[type="search"],input[type="tel"],input[type="time"],input[type="url"],textarea{outline:0px none;-webkit-appearance:none;-moz-appearance:none;color:rgba(0,0,0,0.75);display:block;margin:0;padding:5px 3px;height:25px;width:100%;-moz-box-sizing:border-box;-webkit-box-sizing:border-box;box-sizing:border-box;transition:border-color 0.15s ease-in-out 0s;-webkit-transition:border-color 0.15s ease-in-out 0s;-moz-transition:border-color 0.15s ease-in-out 0s;-ms-transition:border-color 0.15s ease-in-out 0s;-o-transition:border-color 0.15s ease-in-out 0s;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;border:1px solid #e3e3e3}textarea{height:71px}input[type="text"]:focus,input[type="password"]:focus,input[type="date"]:focus,input[type="datetime"]:focus,input[type="datetime-local"]:focus,input[type="month"]:focus,input[type="week"]:focus,input[type="email"]:focus,input[type="number"]:focus,input[type="search"]:focus,input[type="tel"]:focus,input[type="time"]:focus,input[type="url"]:focus,textarea:focus{border-color:#4492ff;-webkit-box-shadow:none;-moz-box-shadow:none;box-shadow:none;outline:0px none}button{cursor:pointer;border-radius:0}details summary{cursor:pointer}details:not([open])>*:not(summary){display:none}.button{-webkit-border-radius:3px;border-radius:3px;-webkit-box-shadow:0 1px 0 rgba(0,0,0,0.05);box-shadow:0 1px 0 rgba(0,0,0,0.05);-webkit-transition:background-color .218s,border-color .218s,box-shadow .218s;transition:background-color .218s,border-color .218s,box-shadow .218s;-webkit-user-select:none;user-select:none;background-color:#fff;border:1px solid #d9d9d9;cursor:pointer;height:28px;line-height:28px;padding:0 10px 0 10px;outline:none;width:auto;background-image:none;-webkit-appearance:none;margin:0}label{margin-bottom:5px;margin-top:10px;display:block}.button:hover{-webkit-box-shadow:0 1px 0 rgba(0,0,0,0.1);box-shadow:0 1px 0 rgba(0,0,0,0.1);border-color:#bfbfbf}.button:active{-webkit-box-shadow:inset 0 1px 0 #ddd;box-shadow:inset 0 1px 0 #ddd;background-color:#e5e5e5;border-color:#bfbfbf}.form-button{padding-top:20px;margin-bottom:40px}::-webkit-input-placeholder{vertical-align:middle;padding:3px 2px}:-moz-placeholder{vertical-align:middle;margin:3px 2px}::-moz-placeholder{vertical-align:middle;margin:3px 2px}:-ms-input-placeholder{vertical-align:middle;margin:3px 2px}main{width:740px;margin:0 auto}.header{width:740px;margin:15px auto;text-align:center}.header .header__search-box{width:300px;margin:0 auto}.header a{text-decoration:underline;font-weight:bold}.logo{width:80px}.header__navigation{margin:20px}.navigation{font-size:.9em}nav ul{list-style-type:none;padding:0;margin:0 0;list-style-position:outside;display:block}nav ul li{display:inline}nav ul li:after{content:"";margin:0 5px;color:#aaaaaa}nav ul li:last-child:after{content:""}.posts-list{list-style:none outside;margin:0}.posts-list-item{position:relative}.posts-list time{position:absolute;left:0;top:0}.posts-list .post-link{display:block;padding-left:4.5em}#content{max-width:740px;width:740px}#content article:first-child{margin-top:0px;min-height:300px !important}#content article{margin:15px;padding:0 15px 15px 15px}#content article header img.author{width:50px;float:left;margin-right:10px;margin-bottom:15px}#content article header strong{display:block;color:#262626}.article__title{font-size:2.5em;letter-spacing:-1.79px;line-height:1.1em}.article__meta{font-size:.75em;color:#aaadad}.excerpt img{float:left;margin-right:15px;margin-bottom:15px;max-width:120px;max-height:120px}.excerpt a.title{color:#4492ff;line-height:1.4;font-size:16px;font-style:normal;font-variant:normal;font-weight:300;max-height:157px;font-size-adjust:none;font-stretch:normal}.excerpt .tags{list-style-type:none;display:inline}.excerpt .tags li{display:inline;background-color:rgba(0,0,0,0.05);background-color:white}.excerpt .tags li:after{content:', ';color:#999}.excerpt .tags li:last-child:after{content:""}.article__excerpt{font-style:italic;padding:10px}footer{text-align:center;padding-top:2rem;padding-bottom:2rem;background:#f3f7f9;background:#fafcfc;color:#596a73}.copyright{font-size:75%}.disclaimer{font-size:75%}.intro{text-align:center}.intro__image{margin:auto;margin-top:120px;width:200px;height:200px}.intro__title{margin-bottom:50px;text-align:center}.intro__lead{color:#aaa;font-size:1.5em;margin-top:30px;font-weight:300;font-style:italic;margin-bottom:120px;margin-top:120px}.social{list-style-type:none;text-align:center;list-style-position:outside;display:block;padding:0;margin:0}.social li{display:inline;padding:0 5px}.social li a{display:inline-block;width:35px;height:35px;color:#404040}.social svg{fill:#848d95;width:35px !important;height:35px !important}aside{display:none}.pagination{width:100%;margin-bottom:20px}.pagination div{width:50%;height:10px}.pagination__previous-url{text-align:left;float:left}.pagination__next-url{text-align:right;float:right}.pagination__previous-arrow,.pagination__next-arrow{width:10%;display:inline-block;vertical-align:middle;text-align:center}.pagination__previous-title,.pagination__next-title{width:85%;display:inline-block;vertical-align:middle;-webkit-box-sizing:border-box;-moz-box-sizing:border-box;box-sizing:border-box;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}.project div.description p{margin:10px 0}.project dl{margin:0;font-size:0.9em}.project dl dt{width:130px;float:left;height:22px}.project dl dd{height:22px}.project h2.approved{background:url(approved.png) 6px 8px no-repeat;margin-left:-30px;padding-left:30px}.project p.approved{color:#888;font-size:14px}.certification-logo{width:300px}.image-wrapper{text-align:center}.image-wrapper .image-caption{color:#828282;margin-top:10px}.alert-success{color:green}.alert-danger{color:red}.add{display:block !important;max-width:420px;width:420px;margin:15px 15px 0 15px;padding:15px;height:100px;max-height:100px;background-color:white}@media screen and (max-width: 740px){.header,main{display:flexbox;display:-ms-flexbox;display:-webkit-box;display:-ms-flexbox;-moz-box-orient:vertical;-webkit-box-orient:vertical;-moz-box-align:center;-webkit-box-align:center;-ms-flex-flow:column;flex-flow:column;width:100%}#side,#content{flex:1;-webkit-box-flex:1 auto;-moz-box-flex:1 auto;-ms-flex:1 auto;width:100%;max-width:100%;position:relative}#content{margin-left:0px}aside{display:none}}@media screen and (max-width: 480px){#content img{display:block;width:100%;max-width:100%;max-height:100%}#content article{margin:10px;padding:0}.excerpt a.title{font-size:1.4em}.excerpt .tags{margin-left:0;padding-left:0}.pagination div{width:100%;height:initial}}span.icon>.fa{cursor:default}.admonitionblock td.icon{text-align:center;width:80px}.admonitionblock td.content{width:100%}.admonitionblock td.icon [class^="fa icon-"]{font-size:1.5em;text-shadow:1px 1px 2px rgba(0,0,0,0.5);cursor:default}.admonitionblock td.icon .icon-note:before{content:"\f05a";content:"📎";color:#19407c}.admonitionblock td.icon .icon-tip:before{content:"\f0eb";content:"💡";text-shadow:1px 1px 2px rgba(155,155,0,0.8);color:#111}.admonitionblock td.icon .icon-warning:before{content:"\f071";content:"⚠";color:#bf6900}.admonitionblock td.icon .icon-caution:before{content:"\f06d";content:"🔥";color:#bf3400}.admonitionblock td.icon .icon-important:before{content:"\f06a";content:"❗";color:#bf0000}pre .conum[data-value]{position:relative;top:-.125em}.conum[data-value]{display:inline-block;color:#fff !important;background-color:rgba(0,0,0,0.8);-webkit-border-radius:100px;border-radius:100px;text-align:center;font-size:.75em;width:1.67em;height:1.67em;line-height:1.67em;font-family:"Open Sans","DejaVu Sans",sans-serif;font-style:normal;font-weight:bold}.conum[data-value]+b{display:none}.conum[data-value]::after{content:attr(data-value)}.hdlist>table,.colist>table{border:0;background:none}.hdlist>table>tbody>tr,.colist>table>tbody>tr{background:none}.colist td:not([class]):first-child{padding:.4em .75em 0;line-height:1;vertical-align:top}.colist td:not([class]):last-child{padding:.25em 0}.colist>table>tbody>tr,.colist>table>tbody>tr>td{border:none}.CodeRay .line-numbers{border-right:1px solid #d8d8d8;padding:0 0.5em 0 .25em}.CodeRay span.line-numbers{display:inline-block;margin-right:.5em;color:rgba(0,0,0,0.3)}.CodeRay .line-numbers strong{color:rgba(0,0,0,0.4)}table.CodeRay{border-collapse:separate;border-spacing:0;margin-bottom:0;border:0;background:none}table.CodeRay td{vertical-align:top;line-height:1.45}table.CodeRay td.line-numbers{text-align:right}table.CodeRay td.line-numbers>pre{padding:0;color:rgba(0,0,0,0.3)}table.CodeRay td.code{padding:0 0 0 .5em}table.CodeRay td.code>pre{padding:0}.CodeRay .debug{color:#fff !important;background:#000080 !important}.CodeRay .annotation{color:#007}.CodeRay .attribute-name{color:#000080}.CodeRay .attribute-value{color:#700}.CodeRay .binary{color:#509}.CodeRay .comment{color:#998;font-style:italic}.CodeRay .char{color:#04d}.CodeRay .char .content{color:#04d}.CodeRay .char .delimiter{color:#039}.CodeRay .class{color:#458;font-weight:bold}.CodeRay .complex{color:#a08}.CodeRay .constant,.CodeRay .predefined-constant{color:#008080}.CodeRay .color{color:#099}.CodeRay .class-variable{color:#369}.CodeRay .decorator{color:#b0b}.CodeRay .definition{color:#099}.CodeRay .delimiter{color:#000}.CodeRay .doc{color:#970}.CodeRay .doctype{color:#34b}.CodeRay .doc-string{color:#d42}.CodeRay .escape{color:#666}.CodeRay .entity{color:#800}.CodeRay .error{color:#808}.CodeRay .exception{color:inherit}.CodeRay .filename{color:#099}.CodeRay .function{color:#900;font-weight:bold}.CodeRay .global-variable{color:#008080}.CodeRay .hex{color:#058}.CodeRay .integer,.CodeRay .float{color:#099}.CodeRay .include{color:#555}.CodeRay .inline{color:#000}.CodeRay .inline .inline{background:#ccc}.CodeRay .inline .inline .inline{background:#bbb}.CodeRay .inline .inline-delimiter{color:#d14}.CodeRay .inline-delimiter{color:#d14}.CodeRay .important{color:#555;font-weight:bold}.CodeRay .interpreted{color:#b2b}.CodeRay .instance-variable{color:#008080}.CodeRay .label{color:#970}.CodeRay .local-variable{color:#963}.CodeRay .octal{color:#40e}.CodeRay .predefined{color:#369}.CodeRay .preprocessor{color:#579}.CodeRay .pseudo-class{color:#555}.CodeRay .directive{font-weight:bold}.CodeRay .type{font-weight:bold}.CodeRay .predefined-type{color:inherit}.CodeRay .reserved,.CodeRay .keyword{color:#000;font-weight:bold}.CodeRay .key{color:#808}.CodeRay .key .delimiter{color:#606}.CodeRay .key .char{color:#80f}.CodeRay .value{color:#088}.CodeRay .regexp .delimiter{color:#808}.CodeRay .regexp .content{color:#808}.CodeRay .regexp .modifier{color:#808}.CodeRay .regexp .char{color:#d14}.CodeRay .regexp .function{color:#404;font-weight:bold}.CodeRay .string{color:#d20}.CodeRay .string .string .string{background:#ffd0d0}.CodeRay .string .content{color:#d14}.CodeRay .string .char{color:#d14}.CodeRay .string .delimiter{color:#d14}.CodeRay .shell{color:#d14}.CodeRay .shell .delimiter{color:#d14}.CodeRay .symbol{color:#990073}.CodeRay .symbol .content{color:#a60}.CodeRay .symbol .delimiter{color:#630}.CodeRay .tag{color:#008080}.CodeRay .tag-special{color:#d70}.CodeRay .variable{color:#036}.CodeRay .insert{background:#afa}.CodeRay .delete{background:#faa}.CodeRay .change{color:#aaf;background:#007}.CodeRay .head{color:#f8f;background:#505}.CodeRay .insert .insert{color:#080}.CodeRay .delete .delete{color:#800}.CodeRay .change .change{color:#66f}.CodeRay .head .head{color:#f4f}.browserupgrade{margin:0.2em 0;background:#ccc;color:#000;padding:0.2em 0}@media print{*,*:before,*:after{background:transparent !important;color:#000 !important;-webkit-box-shadow:none !important;box-shadow:none !important;text-shadow:none !important}a,a:visited{text-decoration:underline}a[href]:after{content:" (" attr(href) ")"}abbr[title]:after{content:" (" attr(title) ")"}a[href^="#"]:after,a[href^="javascript:"]:after{content:""}pre{white-space:pre-wrap !important}pre,blockquote{border:1px solid #999;page-break-inside:avoid}thead{display:table-header-group}tr,img{page-break-inside:avoid}p,h2,h3{orphans:3;widows:3}h2,h3{page-break-after:avoid}}</style><script> var htmlElement = document.getElementsByTagName('html')[0]; htmlElement.style.display = 'none'; htmlElement.className = htmlElement.className.replace('no-js', 'js'); htmlElement.style.overflow = 'hidden'; // Redirect to https var host = "https://dareenzo.github.io"; if (host == window.location.host && window.location.protocol != "https:") { window.location.protocol = "https"; } </script><link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Yrsa|Open+Sans"> <!-- Google Tag Manager --> <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start': new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0], j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src= 'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f); })(window,document,'script','dataLayer','GTM-NCKZVZ');</script> <!-- End Google Tag Manager --><body lang="en"> <!-- Google Tag Manager (noscript) --> <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-NCKZVZ" height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript> <!-- End Google Tag Manager (noscript) --> <!--[if lte IE 9]><p class="browserupgrade">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience and security. <![endif]--><header class="header"><article class="about"> <a href="/"><img class="logo" src="/assets/images/avatar.svg" alt="Paulo Phagula" /></a><h2>Paulo Phagula</h2><p>Musings and Scribbles on Software Development <!--<p class="navigation"> <a href="/about#work" title="Check out some of my work and projects">#work</a> <a href="https://github.com/dareenzo" title="Have a look at my code on github" target="_blank">#code</a> <a href="https://kodikos-io.github.io" title="Check out my Startup Kodikos" target="_blank">#startup</a> --></article><nav class="header__navigation"><ul class="navigation"><li><a class="page-link" href="/blog" title="Read my articles">Articles</a><li><a class="page-link" href="/talks" title="">Talks</a><li><a class="page-link" href="/about" title="Learn more about me and this site">About</a> <!--<li><a class="page-link" href="/services" title="Check out what I can do for you">Services</a><li><a class="page-link" href="/work" title="View some my most notable work and projects">Portfolio</a><li><a class="page-link" href="/contact" title="Get my contacts details so you can reach out to me">Contact</a> --></ul></nav><!-- <form name="search" method="get" action="/search"> <input class="header__search-box" type="search" placeholder="Search ..." name="q" /> </form> --></header><main><section id="content"><article><h1 class="article__title">Test Doubles: A Primer</h1><header><div class="article__meta"> <i class="fa fa-calendar-o" aria-hidden="true"></i> <time class="article__post-date" datetime="2018-10-24T00:00:00+02:00" itemprop="datePublished" content="2018-10-24T00:00:00+02:00">24 Oct 2018</time> | <i class="fa fa-folder-o" aria-hidden="true"></i> Coding <br/> <span class="article__tags"> <i class="fa fa-tags" aria-hidden="true"></i> Mockery&nbsp; Mocking&nbsp; PHP&nbsp; PHPUnit&nbsp; Prophecy&nbsp; TDD&nbsp; Testing&nbsp; </span></div><p class="article__excerpt"></header><div class="sect1"><h2 id="introduction">Introduction</h2><div class="sectionbody"><div class="paragraph"><p>This article emerged as an attempt to provide a more in-depth response to the following question, posted by <a href="https://twitter.com/ivanbila">Ivan</a> on the <a href="http://mozdevz.org/en/">MozDevz</a> <a href="https://t.me/MozDevz">group on Telegram</a>:</div><div class="quoteblock"><blockquote><div class="paragraph"><p>Hi all,</div><div class="paragraph"><p>What&#8217;s the difference between a Mock and a Stub? Can anyone make this clearer?</div><div class="paragraph"><p>Thanks in Advance</div><div class="paragraph"><p>&#8201;&#8212;&#8201;Ivan Bila, on the MozDevz group on Telegram</div></blockquote></div><div class="paragraph"><p>In order to ease understanding by all, I&#8217;ll start by providing a bit more of context as to what he&#8217;s talking about&#8201;&#8212;&#8201;test doubles&#8201;&#8212;&#8201;, why we need them, and when we should use them. Then, address the question more directly by providing <a href="#taxonomy">A taxonomy of test doubles</a>.</div><div class="admonitionblock note"><table><tr><td class="icon"> <i class="fa icon-note" title="Note"></i><td class="content"><div class="paragraph"><p>Even though the example code is written using a particular language, testing framework, and mocking library (PHP, <a href="https://phpunit.de">PHPUnit</a>, and <a href="https://github.com/phpspec/prophecy">Prophecy</a> <sup class="footnote">[<a id="_footnoteref_1" class="footnote" href="#_footnotedef_1" title="View footnote.">1</a>]</sup> ), the content and ideas are generic and can be used in any other platform with any other libraries of choice. I&#8217;d be remiss though, if I didn&#8217;t tell you that, depending on your platform of choice, you may not find direct equivalents of the constructs used here. Regardless, getting bigger picture is what&#8217;s important, since then you can port the ideas to whatever constructs are more idiomatic to your platform.</div></table></div></div></div><div class="sect1"><h2 id="what-are-test-doubles">What are Test Doubles</h2><div class="sectionbody"><div class="paragraph"><p>Test Double is a generic term for any case where you replace a production object or procedure with another for testing purposes. In automated unit testing, a test double replaces an object on which the System Under Test (SUT) depends on.</div><div class="paragraph"><p>Test doubles are popularly (and incorrectly) called Mock objects, but in reality, a mock object is a very specific type of test double.</div><div class="quoteblock"><blockquote><div class="paragraph"><p>The word "mock" is sometimes used in an informal way to refer to the whole family of objects that are used in tests. They are called test doubles.</div><div class="paragraph"><p>&#8201;&#8212;&#8201;Robert C. Martin</div></blockquote></div><div class="quoteblock"><blockquote><div class="paragraph"><p>&#8230;&#8203;They were introduced at XP2000 in a paper called <a href="http://connextra.com/aboutUs/mockobjects.pdf">Endo-Testing: Unit Testing with Mock Objects</a>, and it took a long time after that for them to gain popularity. Their role in software development was still being fleshed out in 2004 when <a href="http://jmock.org/oopsla2004.pdf">Mock Roles, Not Objects</a> was published.</div><div class="paragraph"><p>&#8201;&#8212;&#8201;<a href="https://www.destroyallsoftware.com/blog/2014/tdd-straw-men-and-rhetoric">TDD, Straw Men, and Rhetoric</a></div></blockquote></div><div class="paragraph"><p><strong>The key reason for tests doubles is to help us design how our objects communicate</strong>. They help in verifying indirect output of the SUT, by checking that it interacted with it&#8217;s (direct or indirect) collaborators in an expected way. We do that by replacing the objects the SUT depends on with doubles that record how they are called, such that, we can check if the SUT interacted with it&#8217;s dependencies as expected or not, if it did it at all. This is illustrated in the figure below.</div><div class="imageblock"><div class="content"> <img src="/content/2018/10/testing-mock-objects.png" alt="Test code stimulating SUT and checking expectations on test doubles"></div><div class="title">Figure 1. Test code stimulating the SUT and checking expectations on test doubles through a Mockery</div></div><div class="paragraph"><p>Mock objects help us move from state-based testing to interaction-based testing, where rather than looking at the objects' state, we look at their interactions and behaviour. This stops us from having to add unneeded getters to our code just to be able to assert they have the right state.</div><div class="paragraph"><p>Another reason we use test doubles is for code isolation (Read the "<a href="#warning">A warning about over-isolating, specially through Mocking</a>" section below before jumping to conclusions). When we&#8217;re testing code that depends on another class, we provide the object with a double instance of that class, instead of a real object. That way, we&#8217;re making sure that our test will only fail if the SUT is broken, and not if one of it&#8217;s dependencies is broken.</div><div class="paragraph"><p>Doubles also allow us to replace/override/patch some functions on objects so that we can ease testing. An example of that is when you have written an encoding algorithm which you want to test. This algorithm uses a function <code>getRandomPrime()</code> from another class (in this example <code>RandomGenerator</code>). For testing the encoding algorithm you need to know the value of the parameters and the resulting return value for your assertions. To solve the problem, that the return value depends on a random value you can "stub" the class <code>RandomGenerator</code> and tell the function <code>getRandomPrime()</code> to return 7 every time it&#8217;s called during the test.</div><div class="admonitionblock note"><table><tr><td class="icon"> <i class="fa icon-note" title="Note"></i><td class="content"> We can also create double objects from interfaces. This makes a lot of sense if we think about it. In many cases, we should actually use <em>doubled</em> interfaces in tests instead of doubled concrete classes. After all, the interface is the contract by which classes agree to talk to the outside world.</table></div><div class="paragraph"><p>Summarizing, the typical reasons for using test doubles may include:</div><div class="ulist"><ul><li><p>"These getters we write for testing are cluttering up the design", i.e. adding otherwise unnecessary getters to many objects in order to get object state so that we can verify expectations, ultimately cluttering up the design<li><p>Difficulties with integration testing - some parts are slow or expensive to test<li><p>Non-deterministic behaviour (date &amp; time, web service APIs, pseudo-random functions, etc.)<li><p>Dependency on an external resource: FS, DB, net, printer<li><p>improve the performance of our tests<li><p>real object hasn&#8217;t been written yet<li><p>what you&#8217;re calling has UI/needs human interaction<li><p>simplify test setup<li><p>build in smaller increments</ul></div><div class="quoteblock"><blockquote><div class="paragraph"><p>Sometimes it is just plain hard to test the system under test (SUT) because it depends on other components that cannot be used in the test environment. This could be because they aren&#8217;t available, they will not return the results needed for the test or because executing them would have undesirable side effects. In other cases, our test strategy requires us to have more control or visibility of the internal behaviour of the SUT. When we are writing a test in which we cannot (or chose not to) use a real depended-on component (DOC), we can replace it with a Test Double. The Test Double doesn&#8217;t have to behave exactly like the real DOC; it merely has to provide the same API as the real one so that the SUT thinks it is the real one!</div><div class="paragraph"><p>&#8201;&#8212;&#8201;xUnit Test Patterns: Refactoring Test Code - Gerard Meszaros, 2007</div></blockquote></div></div></div><div class="sect1"><h2 id="allowances-and-expectations">Allowances and Expectations</h2><div class="sectionbody"><div class="paragraph"><p>When working with Test Doubles it&#8217;s important to make a distinction between allowances and expectations.</div><div class="paragraph"><p>Expectations describe the interactions that are essential to the protocol we&#8217;re testing: "if we send this message to the object, we expect to see it send this other message to this neighbor".</div><div class="paragraph"><p>Allowances support the interaction we&#8217;re testing. We often use them as stubs to feed values into the object, to get the object into the right state for the behavior we want to test. We also use them to ignore other interactions that aren&#8217;t relevant to the current test.</div><div class="paragraph"><p>All expectations must be met during a test, but allowances may be matched or not.</div><div class="paragraph"><p>Depending on the tools we&#8217;re using it may be very explicit which is which,&#8201;&#8212;&#8201;for instance, In JMock and Mockery the language is very explicit, but Jasmine and Prophet not so much&#8201;&#8212;&#8201;but what&#8217;s more important is the concept and having in mind what each other is.</div><div class="admonitionblock tip"><table><tr><td class="icon"> <i class="fa icon-tip" title="Tip"></i><td class="content"> Allow Queries; Expect Commands</table></div></div></div><div class="sect1"><h2 id="taxonomy">A taxonomy of test doubles</h2><div class="sectionbody"><div class="paragraph"><p>Terms like <strong>fakes</strong>, <strong>mocks</strong>, and <strong>stubs</strong> are often used interchangeably, however they are not the same. Each replaces a real object in the test environment but the behavior can be quite different:</div><div class="sect2"><h3 id="dummy">Dummy</h3><div class="paragraph"><p>Replaces an object typically as an input to fill parameter lists, that isn&#8217;t used in the test but is needed for the test setup (arranging).</div><div class="paragraph"><p>It&#8217;s methods just return null or comply with their signature, i.e. if it must return a string, it will return an empty string.</div><div class="paragraph"><p>You pass it into something when you don&#8217;t care how it&#8217;s used.</div><div class="paragraph"><p>The example we&#8217;re going to use if of a simple login system, that requires an authorizer object to check for acceptable username/password combinations. Our SUT is the <code>System</code>.</div><div class="paragraph"><p>We&#8217;ll be using Prophecy, and simply put, the way it works, is by having a prophet specify/"predict" the future behavior of objects of interest (prophecies) and then later check that the predictions were met or not. PHPUnit has built-in support for Prophecy and we can used it in our tests by accessing the variable <code>$this&#8594;prophet</code>.</div><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="php"><span class="inline-delimiter">&lt;?php</span>

<span class="keyword">class</span> <span class="class">System</span> {
    <span class="comment">// ...</span>
    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">__construct</span>(<span class="constant">Authorizer</span> <span class="local-variable">$authorizer</span>) {
        <span class="local-variable">$this</span>-&gt;authorizer = <span class="local-variable">$authorizer</span>;
    }

    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">logIn</span>(<span class="local-variable">$username</span>, <span class="local-variable">$password</span>) {
        <span class="keyword">if</span> (<span class="local-variable">$this</span>-&gt;authorizer-&gt;authorize(<span class="local-variable">$username</span>, <span class="local-variable">$password</span>)) {
            <span class="local-variable">$this</span>-&gt;loginCount++;
        }
    }

    <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">getLoginCount</span>() {
        <span class="keyword">return</span> <span class="local-variable">$this</span>-&gt;loginCount;
    }
    <span class="comment">// ...</span>
}

<span class="keyword">class</span> <span class="class">SystemTest</span> {
  <span class="comment">// ...</span>
  <span class="keyword">public</span> <span class="keyword">function</span> <span class="function">test_newly_created_system_has_no_logged_in_users</span>() {
      <span class="local-variable">$authProphecy</span> = <span class="local-variable">$this</span>-&gt;prophet-&gt;prophesize(<span class="constant">Authorizer</span>::<span class="keyword">class</span>); <i class="conum" data-value="1"></i><b>(1)</b>
      <span class="local-variable">$system</span> = <span class="keyword">new</span> <span class="predefined">System</span>(<span class="local-variable">$authProphecy</span>-&gt;reveal()); <i class="conum" data-value="2"></i><b>(2)</b>

      <span class="local-variable">$this</span>-&gt;assertEqual(<span class="integer">0</span>, <span class="local-variable">$system</span>-&gt;getLoginCount()); <i class="conum" data-value="3"></i><b>(3)</b>
  }
  <span class="comment">// ...</span>
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b><td>Using the <code>prophet</code> object we create a new prophecy for an <code>Authorizer::class</code>. Using the created prophecy object we can specify how the <code>Authorizer</code> object will behave and what might our expectations be about it regarding how our SUT interacts with it, i.e. we can say what it should do when poked in a certain way, record what is done to it, and be able to check how the SUT interacted with it, if it did at all.<tr><td><i class="conum" data-value="2"></i><b>2</b><td>by revealing a prophecy we obtain an actual test double object, which we can then use with our SUT. In this example we didn&#8217;t specify any allowances nor expectations on the prophecy, and thus when revealing it all we&#8217;ll get is a dummy for the <code>Authorizer</code> class. We know the SUT won&#8217;t/shouldn&#8217;t interact with dummy during this test and that&#8217;s why we stay at that. We just need the dummy because the <code>System</code> demands and <code>Authorizer</code>, even though it won&#8217;t use it.<tr><td><i class="conum" data-value="3"></i><b>3</b><td>Finally we invoke our SUT and assert it behaved correctly.</table></div></div><div class="sect2"><h3 id="stub">Stub</h3><div class="paragraph"><p>Provides a preset (canned) answer to method calls that we have decided ahead of time, usually not responding at all to anything outside what&#8217;s programmed in for the test.</div><div class="paragraph"><p>With stubs, you don&#8217;t care how many times (if at all) the stub is called. Stubs are used to provide "indirect input" to the system under test.</div><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="php"><span class="inline-delimiter">&lt;?php</span>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">test_counts_successfully_authorized_logIns</span>() {
    <span class="local-variable">$authProphecy</span> = <span class="local-variable">$this</span>-&gt;prophet-&gt;prophesize(<span class="constant">Authorizer</span>::<span class="keyword">class</span>);
    <span class="local-variable">$system</span> = <span class="keyword">new</span> <span class="predefined">System</span>(<span class="local-variable">$authProphecy</span>-&gt;reveal());

    <span class="local-variable">$authProphecy</span>-&gt;authorize(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>)-&gt;willReturn(<span class="predefined-constant">true</span>); <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="local-variable">$system</span>-&gt;logIn(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="local-variable">$this</span>-&gt;assertSame(<span class="integer">1</span>, <span class="local-variable">$system</span>-&gt;getLoginCount()); <i class="conum" data-value="3"></i><b>(3)</b>
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b><td>In this case we define an allowance. Our SUT or any other involved object in our test can interact with the stubbed <code>Authorizer</code> object, and call <code>authorize()</code>, which in turn will return true (regardless of the params in this particular case).<tr><td><i class="conum" data-value="2"></i><b>2</b><td>We invoke the SUT which in turn will interact with the stubbed class, and finally raise the number of login counts.<tr><td><i class="conum" data-value="3"></i><b>3</b><td>Lastly we check our expectations on the SUT.</table></div><div class="paragraph"><p>Put simply a stub is a "When I say 'marco', you say 'polo'"</div><div class="admonitionblock important"><table><tr><td class="icon"> <i class="fa icon-important" title="Important"></i><td class="content"> We could&#8217;ve constrained the stub to only work for some params and not for others, in order to make our test more valid.</table></div></div><div class="sect2"><h3 id="spy-️">Spy 🕵️</h3><div class="paragraph"><p>Acts as a higher level stub, that allows us to also record information about what happened with this test double and how it was called (by the tested code). One form of this might be an email service that records how many messages it has sent or a login service that records what parameters were use to call a method on it.</div><div class="paragraph"><p>It records what functions were called, with what arguments, when, and how often.</div><div class="paragraph"><p>Spies are used for verifying "indirect output" of the tested code, by verifying expectations on how the tested code interacted with the test double afterwards the tested code is executed.</div><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="php"><span class="inline-delimiter">&lt;?php</span>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">test_counts_successfully_authorized_logins</span>() {
    <span class="local-variable">$authProphecy</span> = <span class="local-variable">$this</span>-&gt;prophet-&gt;prophesize(<span class="constant">Authorizer</span>::<span class="keyword">class</span>);
    <span class="local-variable">$system</span> = <span class="keyword">new</span> <span class="predefined">System</span>(<span class="local-variable">$authProphecy</span>-&gt;reveal());

    <span class="local-variable">$authProphecy</span>-&gt;authorize(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>)-&gt;willReturn(<span class="predefined-constant">true</span>);  <i class="conum" data-value="1"></i><b>(1)</b>

    <span class="local-variable">$system</span>-&gt;logIn(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>);

    <span class="local-variable">$authProphecy</span>-&gt;authorize(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>)-&gt;shouldHaveBeenCalled(); <i class="conum" data-value="2"></i><b>(2)</b>
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b><td>Just like before we stub a method on the authorizer which we know the SUT is going to call.<tr><td><i class="conum" data-value="2"></i><b>2</b><td>Notice here that we no longer use some form of assertion, instead we use the prophecy to check wether the SUT did the right thing and called our spy with the expected params <code>('dareenzo', '123')</code>. Our verification could be even more thorough, say something like checking that it was called only once.</table></div></div><div class="sect2"><h3 id="mock">Mock</h3><div class="paragraph"><p>Acts as a higher level stub, that is pre-programmed with expectations, including the ability to both respond to calls they know about and don&#8217;t know about, i.e. they&#8217;re are pre-programmed with expectations which form a specification of the calls they expect to receive.</div><div class="paragraph"><p>They can throw an exception if they receive a call they don&#8217;t expect and are checked during verification to ensure they got all the calls they were expecting.</div><div class="paragraph"><p>Mocks are used for verifying "indirect output" of the tested code, by defining expectations on how the tested code should interact with the double, before the tested code is executed.</div><div class="listingblock"><div class="content"><pre class="CodeRay highlight"><code data-lang="php"><span class="inline-delimiter">&lt;?php</span>
<span class="keyword">public</span> <span class="keyword">function</span> <span class="function">test_counts_successfully_authorized_logins</span>() {
    <span class="local-variable">$authProphecy</span> = <span class="local-variable">$this</span>-&gt;prophet-&gt;prophesize(<span class="constant">Authorizer</span>::<span class="keyword">class</span>);
    <span class="local-variable">$system</span> = <span class="keyword">new</span> <span class="predefined">System</span>(<span class="local-variable">$authProphecy</span>-&gt;reveal());

    <span class="local-variable">$authProphecy</span>-&gt;authorize(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>)-&gt;willReturn(<span class="predefined-constant">true</span>); <i class="conum" data-value="1"></i><b>(1)</b>
    <span class="local-variable">$authProphecy</span>-&gt;authorize()-&gt;shouldBeCalled(); <i class="conum" data-value="2"></i><b>(2)</b>

    <span class="local-variable">$system</span>-&gt;logIn(<span class="string"><span class="delimiter">'</span><span class="content">dareenzo</span><span class="delimiter">'</span></span>, <span class="string"><span class="delimiter">'</span><span class="content">123</span><span class="delimiter">'</span></span>); <i class="conum" data-value="3"></i><b>(3)</b>

    <span class="local-variable">$this</span>-&gt;prophet-&gt;checkPredictions(); <i class="conum" data-value="4"></i><b>(4)</b>
}</code></pre></div></div><div class="colist arabic"><table><tr><td><i class="conum" data-value="1"></i><b>1</b><td>We start by stubbing some behaviour we know is going to be required by the SUT<tr><td><i class="conum" data-value="2"></i><b>2</b><td>Then we specify our expectation<tr><td><i class="conum" data-value="3"></i><b>3</b><td>Invoke the SUT and hope it will satisfy our expectation<tr><td><i class="conum" data-value="4"></i><b>4</b><td>Finally, we check with our prophet if our predictions were met or not.</table></div></div><div class="sect2"><h3 id="fake">Fake</h3><div class="paragraph"><p>Replaces an object for which we need a simplified version of the original/real object, typically to achieve speed improvements or to eliminate side effects.</div><div class="paragraph"><p>Fake objects actually have working implementations, but usually take some shortcut which makes them unsuitable for production (an <code>InMemoryRepository</code> is a good example).</div><div class="paragraph"><p>Unlike other test doubles, no mocking framework is used to create fakes.</div><div class="paragraph"><p>I&#8217;ll refrain from showing a coding example, as I think the idea is very clear for this one. If you&#8217;re testing something that interacts with nukes, don&#8217;t launch the bloody nukes, use a paper fake for now.</div><hr><div class="paragraph"><p>Put in a simpler way:</div><div class="ulist"><ul><li><p>Dummy &#8594; I do nothing at all but to fill parameter list<li><p>Stub &#8594; canned Answers<li><p>Spy &#8594; stubs + interaction recording (for late interaction expectations verification)<li><p>Mock &#8594; stubs + expectations on interaction<li><p>Fake &#8594; I seem real but no</ul></div><div class="paragraph"><p>Just to further clarify Spies and Mocks are similar, the difference between them is that, with Spies we use them and then check expectations afterwards; while with Mocks we define the expectations beforehand and only then we use them</div></div></div></div><div class="sect1"><h2 id="warning">A warning about over-isolating, specially through Mocking</h2><div class="sectionbody"><div class="paragraph"><p>Due to wrong influences, many people fall for relentless isolation and end-up finding solace in test doubles as their magic tool for helping in isolating parts, yet they&#8217;re just painting themselves into a corner with a painful cost to get out from.</div><div class="paragraph"><p>Mocking is about object communication and interface discovery, using it for isolation, specially from 3rd party code is a misuse, in fact a general rule of thumb when mocking is "do not mock what you don&#8217;t own". Wrappers and Anti-Corruption Layers are more appropriate tools for avoiding contamination by 3rd code than mock objects.</div><div class="paragraph"><p>Additionally, over-mocking can usually have the effect of duplicating implementation code in the tests as we try to mock the behaviour of objects. This code quickly gets outdated as we change the production code, and give us the work of trying to keep production and test code in sync. We should refrain from this and try as much as possible to use real collaborators when possible, as Sandi Metz and Katrina Owen put it:</div><div class="quoteblock"><blockquote><div class="paragraph"><p>When your tests use the same collaborators as your application, they always break when they should. The value of this cannot be underestimated</div><div class="paragraph"><p>&#8201;&#8212;&#8201;Sandi Metz &amp; Katrina Owen</div></blockquote></div></div></div><div class="sect1"><h2 id="resources">Resources</h2><div class="sectionbody"><div class="paragraph"><p>The bestest&#8201;&#8212;&#8201;pun intended&#8201;&#8212;&#8201;resource on Mocking is the <a href="http://www.growing-object-oriented-software.com">Growing Object-Oriented Software, Guided by Tests (GOOS)</a> book by Steve Freeman and Nat Pryce. They&#8217;re the pioneers of the technique and better than anyone took the time to distill their experience with using Mock Objects in the book.</div><div class="paragraph"><p>With that said, I can&#8217;t recommend more the following two talks, they&#8217;re made by the very pillars of testing in PHP community.</div><div class="paragraph"><p>Recommended Video on Mocking: <a href="https://www.youtube.com/watch?v=AHizK2kpukk">Design how your objects talk to each other through mocking - Konstantin Kudryashov</a></div><div class="paragraph"><p>Recommended video on not over isolating through mocking: <a href="https://www.youtube.com/watch?v=LdUKfbG713M">Lies You&#8217;ve Been Told About Testing - Adam Wathan - Laracon Online 2017</a></div></div></div><div class="sect1"><h2 id="closing">Closing</h2><div class="sectionbody"><div class="paragraph"><p>So what do you say, guys and gals, Ivan, is it clear now?</div></div></div><div id="footnotes"><hr><div class="footnote" id="_footnotedef_1"> <a href="#_footnoteref_1">1</a>. If you wonder why I didn&#8217;t use PHPUnit&#8217;s built-in mocking facilities, it&#8217;s because they&#8217;re pretty much only there to keep backwards compatibility. Sebastian Bergmann&#8201;&#8212;&#8201;the creator of PHPUnit&#8201;&#8212;&#8201;himself has said he does not recommend using them, and suggests we use Prophecy, so much so he added "native" support for it onto PHPUnit.</div></div><hr/><div class="sharing"><p> Share this on: <a title="Share article on Email" href="mailto:?subject=Test Doubles: A Primer &body=https%3A%2F%2Fdareenzo.github.io%2Fblog%2F2018%2F10%2F24%2Ftest-doubles-a-primer%2F">Mail</a> - <a title="Share article on Twitter" target="_blank" href="https://twitter.com/intent/tweet?url=https%3A%2F%2Fdareenzo.github.io%2Fblog%2F2018%2F10%2F24%2Ftest-doubles-a-primer%2F&text=Test%20Doubles:%20A%20Primer%0A&via=dareenzo">Twitter</a> - <a title="Share article on Facebook" target="_blank" href="https://www.facebook.com/sharer.php?u=https%3A%2F%2Fdareenzo.github.io%2Fblog%2F2018%2F10%2F24%2Ftest-doubles-a-primer%2F">Facebook</a></div><div class="pagination"><div class="pagination__previous-url"> <a href="/blog/2018/05/04/mysql-subtleties/" title="A few MySQL subtleties and how to go about them" rel="prev"> <span class="pagination__previous-arrow"><i class="fa fa-long-arrow-left" aria-hidden="true"></i></span> <span class="pagination__previous-title">A few MySQL subtleties and how to go about them</span> </a></div><div class="pagination__next-url"> <a href="/blog/2018/11/08/splitting-and-naming-test-cases-better/" title="Splitting and Naming Test Cases Better" rel="next"> <span class="pagination__next-title">Splitting and Naming Test Cases Better</span> <span class="pagination__next-arrow"><i class="fa fa-long-arrow-right" aria-hidden="true"></i></span> </a></div><div class="clearfix"></div></div><div class="related-posts"></div><hr /><div class="comments"><p>Please, use <a href="https://help.disqus.com/customer/portal/articles/665057-syntax-highlighting">syntax highlighting</a> in your comments, to make them more readable.<div id="disqus_thread"></div><noscript>Please, enable JavaScript to see the <a href="http://disqus.com/?ref_noscript">comments</a></noscript></div></article><script> var disqus_config = function () { this.page.url = 'https://dareenzo.github.io/blog/2018/10/24/test-doubles-a-primer/'; this.page.identifier = 'https://dareenzo.github.io/blog/2018/10/24/test-doubles-a-primer/'; }; (function() { var d = document, s = d.createElement('script'); s.src = 'https://dareenzo.disqus.com/embed.js'; s.setAttribute('data-timestamp', +new Date()); (d.head || d.body).appendChild(s); })(); </script></section><div class="clearfix"></div></main><footer class="footer"><ul class="social"><li><a href="mailto:paulo.phagula@gmail.com" target="_blank" title="Drop me an email"><i class="fa fa-envelope-o" aria-hidden="true"></i></a><li><a href="https://github.com/dareenzo" target="_blank" title="Fork my code on Github"><i class="fa fa-github" aria-hidden="true"></i></a><li><a href="https://stackoverflow.com/users/6270740/paulo-phagula" target="_blank" title="Help me out with some questions on StackOverflow"><i class="fa fa-stack-overflow" aria-hidden="true"></i></a><li><a href="https://www.linkedin.com/in/paulo-phagula" target="_blank" title="Connect with me on Linkedin if you, too, need to put up with this crap against your will"><i class="fa fa-linkedin" aria-hidden="true"></i></a><li><a href="https://twitter.com/dareenzo" target="_blank" title="Follow me on Twitter"><i class="fa fa-twitter" aria-hidden="true"></i></a><li><a href="/feed.rss.xml" target="_blank" title="Stay up-to-date with all the blog posts via RSS"><i class="fa fa-feed" aria-hidden="true"></i></a></ul><p class="copyright"> Copyright &copy; 2014 - 2019 Paulo Phagula.<br/> Some rights reserved</footer><script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/prism.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/plugins/toolbar/prism-toolbar.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/plugins/normalize-whitespace/prism-normalize-whitespace.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.11.0/plugins/copy-to-clipboard/prism-copy-to-clipboard.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.12.2/components/prism-python.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.12.2/components/prism-php.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.12.2/components/prism-ruby.min.js"></script> <script src="https://cdnjs.cloudflare.com/ajax/libs/prism/1.12.2/components/prism-sql.js"></script> <script type="text/javascript"> htmlElement.style.display = 'block'; htmlElement.style.overflow = ''; </script>
